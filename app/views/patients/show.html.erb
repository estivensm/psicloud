<div class="row">
   <div class="col-md-12" style="padding-left: 50px;">
      <%= link_to "inicio", root_path%><span> | </span> 
      <%= link_to "pacientes", patients_path%>
   </div>
</div>
<div class="container-fluid">
   <div class="row">
      <div class="col-xs-12 col-sm-12 col-md-5 col-lg-5 col-xs-offset-0 col-sm-offset-0 toppad" >
         <div class="panel panel-info">
            <div class="panel-heading" style="        background: #f9f9f9;
               color: #808080;">
               <h3 class="panel-title" style="font-size: 20px"> <%= @patient.first_name %> <%= @patient.second_name %>  <%= @patient.first_last_name %>  <%= @patient.second_last_name %></h3>
            </div>
            <div class="panel-body" style="padding-top: 40px;">
               <div class="row img">
                  <div class="col-md-3 col-lg-3 " align="center">  <%= @patient.avatar? ? image_tag(@patient.avatar_url) : image_tag("https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcRuEG5mQKFGi9hNgrdBJnEyBfw2Kl0JNXwoHiXjVeKQemKOQqFe")  %> </div>
                  <div class="col-md-7 col-lg-7 info-p" >
                     <p><strong> <%= @patient.document_type%>: </strong><%= @patient.document%> </p>
                     <p><strong>Fecha de Nacimiento: </strong><%= @patient.birth_date%> </p>
                     <% year = @patient.age == 1 ? "Año" : " Años"
                        month = @patient.birthdate_month == 1 ? " Mes" : " Meses"
                        day =  @patient.birthdate_day == 1 ?  " Día" : " Días"
                        %>
                     <p><strong>Edad: </strong><%=@patient.age.to_s + year  %> <%=@patient.birthdate_month.to_s + month   %> <%=@patient.birthdate_day.to_s +  day %></p>
                     <p><strong>Genero: </strong><%= @patient.gender%> </p>
                     <button type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal">Ver mas</button>
                  </div>
                  <div class="col-md-12 col-lg-12 info-p" style= "padding:20px;text-align: center;" >
                     <hr>
                     <%if @patient.age >= 18%>
                     <%= link_to  patient_consentimiento_informado_path(@patient.id, @patient.id,@clinic_history , :format => "pdf"),target: "_blank" , :class => "" do  %>
                     <i class="fa fa-bullhorn" style = "font-size:30px;" aria-hidden="true"></i>
                     Consentimiento Informado
                     <%end%>
                     <%elsif @patient.age >= 12 &&  @patient.age < 18%>
                     <%= link_to  patient_consentimiento_informado_adolescentes_path(@patient.id, @patient.id,@clinic_history , :format => "pdf"),target: "_blank" , :class => "" do  %>
                     <i class="fa fa-bullhorn" style = "font-size:30px;" aria-hidden="true"></i>
                     Consentimiento Informado
                     <%end%>
                     <%else%>
                     <%= link_to  patient_consentimiento_informado_menores_path(@patient.id, @patient.id,@clinic_history , :format => "pdf"),target: "_blank" , :class => "" do  %>
                     <i class="fa fa-bullhorn" style = "font-size:30px;" aria-hidden="true"></i>
                     Consentimiento Informado
                     <%end%>
                     <%end%>
                     <!--<p style = "font-size:16px"><i class="fa fa-calendar" aria-hidden="true"></i><strong> Proxima Cita: </strong>&nbsp;  3 de julio de 2016  &nbsp; <%= link_to  root_path , :class => "opciones" do %>
                        <i class="fa fa-pencil" aria-hidden="true"></i> 
                        <% end %>&nbsp;<%= link_to  root_path , :class => "opciones" do %>
                        <i class="fa fa-trash" aria-hidden="true"></i> 
                        <% end %>
                        </p>-->
                  </div>
                  <!--<div class="col-xs-10 col-sm-10 hidden-md hidden-lg"> <br>
                     <dl>
                       <dt>DEPARTMENT:</dt>
                       <dd>Administrator</dd>
                       <dt>HIRE DATE</dt>
                       <dd>11/12/2013</dd>
                       <dt>DATE OF BIRTH</dt>
                          <dd>11/12/2013</dd>
                       <dt>GENDER</dt>
                       <dd>Male</dd>
                     </dl>
                     </div>-->
               </div>
            </div>
            <div class="panel-footer text-right">
               <%= link_to  edit_patient_path(@patient.id), class: "btnl btn-warning" do%>
               <i class="fa fa-pencil" style = "font-size:20px;"  aria-hidden="true"></i>
               <%end%>
            </div>
         </div>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-7 col-lg-7 col-xs-offset-0 col-sm-offset-0 toppad" >
         <div id="exTab2">
            <ul class="nav nav-tabs">
              
            <%if current_user.rol.show_hc%>
            <li class="active">
                  <a  href="#1" data-toggle="tab">Historia Clinica</a>
               </li>
            <%end%>
              <%if current_user.rol.show_hc%>  
               <li><a href="#2" data-toggle="tab">Seguimientos</a>
               </li>
                <%end%>
             <%if current_user.rol.show_hc%>    
               <li><a href="#4" data-toggle="tab">Proxima Cita</a>
               </li>
                 <%else%> 
                    <li class="active"><a href="#4" data-toggle="tab">Proxima Cita</a>
               </li>
             <%end%>  
            </ul>
            <div class="tab-content ">
             <%if current_user.rol.show_hc%>
               <div class="tab-pane active" id="1">
                  <%if @hs != nil%>
                  <div class="descnum">
                     <br>
                     <div class="row">
                        <div class="col-md-8">
                           <h2>Información Principal</h2>
                        </div>
                        <div class="col-md-4 text-right">
                               <button type="button" class="btnl btn-info" data-toggle="modal" data-target="#send-mail"><i class="fa fa-envelope" style = "font-size:30px;"  aria-hidden="true"></i></button>
                           <%= link_to  patient_clinic_history_path(@patient.id,@hs), class: "btnl btn-primary" do%>
                           <i class="fa fa-eye" style = "font-size:30px;"  aria-hidden="true"></i>
                           <%end%>
                           <%if current_user.rol.create_hc%>
                           <%= link_to  edit_patient_clinic_history_path(@patient.id,@hs), class: "btnl btn-warning" do%>
                           <i class="fa fa-pencil" style = "font-size:30px;"  aria-hidden="true"></i>
                           <%end%>
                           <%end%>

                        </div>
                     </div>
                     <div class="descnum1">
                        <h4>
                        Motivo de consulta</h3>
                        <hr>
                        <p><%= @hs.consultation_reason %></p>
                     </div>
                     <div class="descnum1">
                        <h4>
                        Estado Actual</h3>
                        <hr>
                        <p><%= @hs.actual_state %></p>
                     </div>
                     <div class="descnum1">
                        <h4>
                        Hipotesis diagnostical</h3>
                        <hr>
                        <p><%= @hs.diagnostic_hypothesis %></p>
                     </div>
                     <div class="descnum1">
                        <h4>
                        Objetivo Terapeoutico</h3>
                        <hr>
                        <p><%= @hs.therapeutic_goal %></p>
                     </div>
                     <div class="descnum1" >
                        <h4>
                        Tipo de Tratamiento</h3>
                        <hr>
                        <p><%= @hs.type_of_treatment %></p>
                     </div>
                  </div>
                  <%else%>
                  <br><br><br>
                  <div class="alert-info" style="padding:20px;">
                               <h2 class="text-center" >No se ha crado la Historia Clinica <br><br> 

                               <%= link_to "Crear Historia Clinica", new_patient_clinic_history_path(@patient.id), class: "btn btn-primary", style: "font-size:20px" if current_user.rol.create_hc%></h2>
                  </div>
       
                  <%end%>
               </div>
               <%end%>
                 <%if current_user.rol.show_hc%>
               <div class="tab-pane" id="2">
                  <br><br>
                  <%if @hs != nil%>

                  <%if @hs.tracings.count != 0%>
                  <div class="row">
                     <div class="col-md-12 text-right">
                        <%= link_to "Ver Seguimientos", patient_clinic_history_tracings_path(@patient.id,@hs ), class: "btn btn-primary"%>
                     </div>
                  </div>
                  <br>
                  <h3>Ultimos Seguimientos</h3>
                  <br>
                  <% @hs.tracings.last(2).each do |tracing|  %>
                  <div class="row">
                     <div class="col-md-3">
                        <p><%= get_date(tracing.created_at)%></p>
                     </div>
                     <div class="col-md-6">
                        <p><%=tracing.description%></p>
                     </div>
                     <div class="col-md-3">
                        <p><%= (link_to "Adjunto", tracing.attachment_url) if tracing.attachment_url %></p>
                     </div>
                  </div>
                  <hr>
                  <%end%>
                  <%else%>
                <div class="alert-info" style="padding:20px;">
                  <h2 class="text-center">No hay ninugun seguimiento <br>  <br><%= link_to "Crear Seguimiento", new_patient_clinic_history_tracing_path(@patient.id,@hs ), remote: true, class: "btn btn-primary", style: "font-size:20px" if current_user.rol.create_hc%></h2>  </div>
                  <%end%>
              
                  <%else%>
                   <div class="alert-info" style="padding:20px;">
     <h2 class="text-center" >No hay seguimientos ya que no existe la Historia Clinica</h2> </div>
                  <%end%>  
              
                </div>
                  <%end%> 
                 <%if current_user.rol.show_hc%>
               <div class="tab-pane" id="4">
               <%else%>
                <div class="tab-pane active" id="4">
               <%end%>
                  <br><br>
                  <%if @patient.appointments.count != 0%>
                  <% a =  get_date_array(@patient.appointments.last.start_datetime)%>
                  <div class="col-md-4 text-right">
                     <img style = "width:135px" src="https://blog.rankwatch.com/wp-content/uploads/2017/09/if_calendar-clock_299096-1.png" alt="">
                  </div>
                  <div class="col-md-8" style="color:gray">
                     <% if @appointment_l != nil%>
                     <span style="font-size:70px;"><%=a[5] %></span><br>
                     <span style="font-size:20px;"><%=a[1]%> <%= a[0] %> de <%= a[2]%> de <%= a[4] %></span>
                     <%else%>
                     <span style="font-size:20px;position: relative;
                        top: 50px;">No hay citas programadas</span>
                     <%end%>  
                  </div>
                  <div class="col-md-12 text-center" style="margin:20px 0 20px 0; ">
                     <%= link_to "Historial de Citas", patient_appointments_path(@patient.id ), class: "btn btn-primary", style:"margin-right:40px;"%>
                  
                     <%= link_to "Nueva Cita", new_patient_appointment_path(@patient.id ) , remote:true, class: "btn btn-primary" if current_user.rol.create_cita %>
                  </div>
                  <div class="col-lg-12">
                     <h3>Ultimas Citas</h3>
                  </div>
                  <% @patient.appointments.last(2).each do |appointment|  %>
                  <% b =  get_date_array(appointment.start_datetime)%>
                  <div class="row">
                     <div class="col-md-5">
                        <p> <span style="font-size:16px;"><%=b[1]%> <%= b[0] %> de <%= b[2]%> de <%= b[4] %></span></p>
                     </div>
                     <div class="col-md-7">
                        <p><%=appointment.observations%></p>
                     </div>
                  </div>
                  <hr>
                  <%end%>
                  <%else%>
                      <div class="alert-info" style="padding:20px;">
                  <h2 class="text-center">El Paciente no tiene citas<br> <br><%= link_to "Historial de Citas", patient_appointments_path(@patient.id ), class: "btn btn-primary", style: "font-size:20px" if current_user.rol.show_cita%> <%= link_to "Nueva Cita", new_patient_appointment_path(@patient.id ) , remote:true, class: "btn btn-primary", style: "font-size:20px" if current_user.rol.create_cita%></h2>  </div>
                  <%end%>  
                
               </div>
            </div>
         </div>
      </div>
   </div>
</div>
<style>
   .descnum1
   {
   padding: 10px;
   background: #f7f7f7;
   margin-bottom: 5px;
   }
   .descnum1 h4
   {
   color: #5d5d5d !important;
   }
   .descnum1 p
   {
   margin-left: 30px;
   }
   .user-row {
   margin-bottom: 14px;
   }
   .user-row:last-child {
   margin-bottom: 0;
   }
   .dropdown-user {
   margin: 13px 0;
   padding: 5px;
   height: 100%;
   }
   .dropdown-user:hover {
   cursor: pointer;
   }
   .table-user-information > tbody > tr {
   border-top: 1px solid rgb(221, 221, 221);
   width: 25%;
   }
   .table-user-information > tbody > tr:first-child {
   border-top: 1px solid rgb(221, 221, 221);
   width: 25%;
   }
   .table-user-information > tbody > tr > td {
   border-top: 1px solid rgb(221, 221, 221);
   width: 25%;
   }
   .toppad
   {margin-top:20px;
   }
   .img img
   {
   width: 90px;
   }
   .img1 img
   {
   width: 120px;
   }
   h3
   {
   font-size:20px;
   color: #3b84a7;
   }
   .info-p p
   {
   font-size: 14px;
   }
</style>
<script>
   $(document).ready(function() {
     var panels = $('.user-infos');
     var panelsButton = $('.dropdown-user');
     panels.hide();
   
     //Click dropdown
     panelsButton.click(function() {
         //get data-for attribute
         var dataFor = $(this).attr('data-for');
         var idFor = $(dataFor);
   
         //current button
         var currentButton = $(this);
         idFor.slideToggle(400, function() {
             //Completed slidetoggle
             if(idFor.is(':visible'))
             {
                 currentButton.html('<i class="glyphicon glyphicon-chevron-up text-muted"></i>');
             }
             else
             {
                 currentButton.html('<i class="glyphicon glyphicon-chevron-down text-muted"></i>');
             }
         })
     });
   
   
     $('[data-toggle="tooltip"]').tooltip();
   
     $('button').click(function(e) {
         e.preventDefault();
      
     });
   });
</script>
<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
   <div class="modal-dialog modal-lg">
      <!-- Modal content-->
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <div class="panel-heading" style="color:#3b84a7">
               <h3 class="panel-title" style="font-size: 25px"> <%= @patient.first_name %> <%= @patient.second_name %>  <%= @patient.first_last_name %>  <%= @patient.second_last_name %></h3>
            </div>
         </div>
         <div class="modal-body">
            <div class="" >
               <div class="panel panel-info">
                  <div class="panel-body" style="padding-top: 40px;">
                     <div class="row img1">
                        <div class="col-md-4 col-lg-4 " align="center">  <%= @patient.avatar? ? image_tag(@patient.avatar_url) : image_tag("https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcRuEG5mQKFGi9hNgrdBJnEyBfw2Kl0JNXwoHiXjVeKQemKOQqFe")  %> </div>
                        <div class="col-md-6 col-lg-6 info-p" >
                           <p><strong>Documento: </strong> <%= @patient.document_type%>: <%= @patient.document%> </p>
                           <p><strong>Fecha de Nacimiento: </strong><%= @patient.birth_date%> </p>
                           <% year = @patient.age == 1 ? "Año" : " Años"
                              month = @patient.birthdate_month == 1 ? " Mes" : " Meses"
                              day =  @patient.birthdate_day == 1 ?  " Día" : " Días"
                              %>
                           <p><strong>Edad: </strong><%=@patient.age.to_s + year  %> <%=@patient.birthdate_month.to_s + month   %> <%=@patient.birthdate_day.to_s +  day %></p>
                           <p><strong>Genero: </strong><%= @patient.gender%> </p>
                        </div>
                        <!--<div class="col-xs-10 col-sm-10 hidden-md hidden-lg"> <br>
                           <dl>
                             <dt>DEPARTMENT:</dt>
                             <dd>Administrator</dd>
                             <dt>HIRE DATE</dt>
                             <dd>11/12/2013</dd>
                             <dt>DATE OF BIRTH</dt>
                                <dd>11/12/2013</dd>
                             <dt>GENDER</dt>
                             <dd>Male</dd>
                           </dl>
                           </div>-->
                        <div class=" col-md-12 col-lg-12 " style = "margin-top:10px;">
                           <table class="table table-user-information" style = "margin-bottom:0px !important">
                              <tbody>
                                 <tr>
                                    <th>Ocumpacion:</th>
                                    <td><%= @patient.occupation%></td>
                                    <th>Profesion:</th>
                                    <td><%= @patient.profession%></td>
                                    <th>Ciudad:</th>
                                    <td><%= @patient.city%></td>
                                 </tr>
                                 <tr>
                                    <th>Direccion:</th>
                                    <td><%= @patient.address%></td>
                                    <th>Telefono Fijo:</th>
                                    <td><%= @patient.phone%></td>
                                    <th>Telefono Movil:</th>
                                    <td><%= @patient.movil%></td>
                                 </tr>
                                 <tr>
                                    <th>Email:</th>
                                    <td><%= @patient.email%></td>
                                    <th>Estado Civil:</th>
                                    <td><%= @patient.civil_status%> </td>
                                    <th>Grupo Etnico:</th>
                                    <td><%= @patient.ethnic_group%></td>
                                 </tr>
                                 <tr>
                                    <th>EPS:</th>
                                    <td><%= @patient.hpc.name if @patient.hpc%> </td>
                                    <th>Convenio:</th>
                                    <td><%= @patient.agreement.name if @patient.agreement%></td>
                                    <th>Nombre Contacto:</th>
                                    <td><%= @patient.contact_name%> (<%=@patient.contact_relationship%>) </td>
                                 </tr>
                                 <tr>
                                    <th>Telefono del Contacto:</th>
                                    <td><%= @patient.contact_phone%></td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
         </div>
      </div>
   </div>
</div>

<%= render 'form_send_history' , patient: @patient %>
<style>
   .nav-tabs>li>a {
   background: #277394;
   color: white;
   margin-right: 2px;
   line-height: 1.42857143;
   border: 1px solid rgba(12, 12, 12, 0.51);
   border-radius: 0px;
   }
</style>